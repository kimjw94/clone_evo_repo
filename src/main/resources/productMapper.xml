<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.market.evo.product.ProductMapper">

	<!-- categoryName -->
	<select id="categoryList" resultType="map">
		select * from evo_category
	</select>

	<!-- detailCategoryName -->
	<select id="detailCateList" parameterType="int" resultType="map">
		select d_category_detail_code, d_category_detail_name
		from
		evo_category_detail
		where d_category_code = #{c_category_code}
	</select>

	<!-- 상품 추가 -->
	<insert id="addProduct"
		parameterType="com.market.evo.product.Product">
		insert into evo_product
		values (
		seq_p_product_no.nextval,
		#{p_product_name},
		#{p_m_id},
		#{p_category_code},
		#{p_price},
		#{p_info},
		default,
		default,
		default
		)
	</insert>

	<!-- 상품 이미지 추가 -->
	<insert id="addImage" parameterType="map">
		insert into
		evo_product_image(im_p_product_no, im_thumbnail_image, im_info_image)
		values(
		#{im_p_product_no},
		#{im_thumbnail_image},
		#{im_info_image}
		)
	</insert>

	<insert id="addInventory" parameterType="map">
		insert into
		evo_product_inventory
		values(
		#{i_p_product_no},
		#{i_product_color},
		#{i_product_size},
		#{i_product_count}
		)
	</insert>

	<!-- 상품 번호 불러오는거 -->
	<select id="getProNo"
		parameterType="com.market.evo.product.Product" resultType="int">
		select
		p_product_no
		from evo_product
		where p_addDay = (select max(p_addDay)
		from (
		select p_addDay
		from evo_product
		where p_product_name =
		#{p_product_name}
		and p_m_id = #{p_m_id}
		and p_category_code =
		#{p_category_code}))
	</select>

	<select id="idViewProduct" parameterType="String"
		resultType="map">
		select p.p_view, p.p_price, p.p_product_name,
		p.p_product_no,
		i.im_thumbnail_image
		from evo_product p,
		evo_product_image i, evo_member m
		where p.p_product_no =
		i.im_p_product_no
		and m.m_id = p.p_m_id
		and p.p_m_id = #{p_m_id}

	</select>

	
	<!-- 삼풍 상세정보 불러오기 (재고 빼고) -->
	<select id="detailProduct" parameterType="int" resultType="map">
		select  p.p_product_name, p.p_price, p.p_info,
				c.c_category_name, d.d_category_detail_name,
				im.im_thumbnail_image, im.im_info_image
  		from evo_product p, evo_product_image im,
  				evo_category c, evo_category_detail d
 		where p.p_product_no = #{p_product_no}
   			and p.p_category_code = d.d_category_detail_code
   			and d.d_category_code = c.c_category_code
   			and im.im_p_product_no = p.p_product_no
	</select>
	
	<!-- 재고만 따로 불러오기 -->
	<select id="detailInventory" parameterType="int" resultType="map">
		select * from evo_product_inventory
		  where i_p_product_no = #{p_product_no}
	
	</select>
	

	<!--상의라는 카테고리에 포함되는 상품정보,상품이미지 가져오기 -->
	<select id="getProductsWithImagebyCategory" resultType="map">
		select
		p.*, I.IM_THUMBNAIL_IMAGE
		from evo_product p join evo_category_detail d
		on p.p_category_code = d.d_category_detail_code
		join evo_category c on
		c.c_category_code = d.d_category_code
		join evo_product_image i on
		p.p_product_no = i.im_p_product_no
		where p.p_category_code =
		d.d_category_detail_code
		and d.d_category_code = c.c_category_code
		and
		c.c_category_name= #{categoryName}
	</select>
	<select id="getProductswithImagebyDetailCategory"
		resultType="map">
		select p.*, I.IM_THUMBNAIL_IMAGE
		from evo_product p
		join
		evo_category_detail d on p.p_category_code = d.d_category_detail_code
		join evo_product_image i on p.p_product_no = i.im_p_product_no
		where
		p.p_category_code = d.d_category_detail_code
		and
		d.d_category_detail_name= #{categoryDetailName}
	</select>

	<select id="getProductDetail" resultType="map" >
SELECT
    p.p_product_name,
    p.p_m_id,
    p.p_price,
    p.p_info,
    p.p_view,
    im.im_thumbnail_image,
    im.im_info_image,
    c.c_category_name,
    cd.d_category_detail_name
FROM
    EVO_PRODUCT p
JOIN
    EVO_PRODUCT_IMAGE im ON p.p_product_no = im.im_p_product_no
JOIN
    EVO_CATEGORY_DETAIL cd ON p.p_category_code = cd.d_category_detail_code
JOIN
    EVO_CATEGORY c ON cd.d_category_code = c.c_category_code
WHERE
    p.p_product_no = #{productNo}
	</select>
	
	<select id ="getProductInventory" resultType="map">
	
SELECT
  	i_product_color,
    i_product_size
FROM
    evo_product_inventory
WHERE
    i_p_product_no = #{productNo}
	
	</select>


</mapper>